#!/bin/busybox sh

set -e

mkdir -p /newroot
mount /dev/sda4 /newroot

echo "Moving mounts to /newroot"
mkdir -p "/newroot/sys"
mount -n -o move "/sys" "/newroot/sys"
mkdir -p "/newroot/proc"
mount -n -o move "/proc" "/newroot/proc"
mkdir -p "/newroot/dev"
mount -n -o move "/dev" "/newroot/dev"
mkdir -p "/newroot/run"
mount -n -o move "/run" "/newroot/run"

echo "exec switch_root"
echo "this shouldn't take more than a few seconds"
chmod +x /newroot/sbin/init
exec switch_root /newroot /sbin/init -v --default-console output || :